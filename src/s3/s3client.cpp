// S3Client.cpp
// By Mike Kuta
// August 20, 2015
//
// My attempt to extend the libqtaws by Paul Colby to implement the Amazon S3 functions
// that I need.
//
// libqtaws is licensed under the GNU Lesser General Public License.
//
// https://github.com/pcolby/libqtaws
//
// Copyright Â© 2015 Kuta Software LLC.  All rights reserved.


#include "s3client.h"
#include "s3client_p.h"
#include "awssignaturev4.h"

#include "s3putobjectrequest.h"
#include "s3putobjectresponse.h"

#include <QNetworkAccessManager>
#include <QNetworkReply>
#include <QNetworkRequest>


#define S3_SERVICE_NAME QLatin1String("s3")


QTAWS_BEGIN_NAMESPACE



//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
S3Client::S3Client(const AwsRegion::Region region, AwsAbstractCredentials * credentials, QNetworkAccessManager * const manager, QObject * const parent)
    : AwsAbstractClient(new S3ClientPrivate(this), parent)
{
    Q_D(S3Client);
    d->region = region;
    d->credentials = credentials;
    d->networkAccessManager = manager;
    d->serviceName = S3_SERVICE_NAME;
}




//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
S3PutObjectResponse * S3Client::putObject(const QString & bucketName, const QString & fileName, const QString & s3ObjectName)
{
    S3PutObjectRequest request(bucketName, fileName, s3ObjectName);
    return putObject(request);
}




//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
S3PutObjectResponse * S3Client::putObject(const S3PutObjectRequest & request)
{
    return qobject_cast<S3PutObjectResponse *>(send(request));
}




//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
S3ClientPrivate::S3ClientPrivate(S3Client * const q)
    : AwsAbstractClientPrivate(q)
{
    signature = new AwsSignatureV4();
}


QTAWS_END_NAMESPACE
